<html>
    <head>
        <!--HTML file auto generated using EmulatorJS codehelper-->
        <style>
            html, body {
                margin: 0;
                padding: 0;
                height: 100vh;
                display: flex;
                flex-direction: column;
                font-family: Arial, sans-serif;
            }
            #game-selector {
                display: flex;
                justify-content: center;
                gap: 10px;
                padding: 10px;
                background-color: #f0f0f0;
                border-bottom: 1px solid #ccc;
                flex: none;
            }
            #game-selector button {
                padding: 8px 16px;
                background-color: #0064ff;
                color: white;
                border: none;
                border-radius: 4px;
                cursor: pointer;
                font-size: 14px;
            }
            #game-selector button:hover {
                background-color: #0056d2;
            }
            #game-selector button.active {
                background-color: #004494;
            }
            #content {
                flex: 1;
                position: relative;
                overflow: hidden;
            }
            #preview-container {
                width: 100%;
                height: 100%;
                display: flex;
                justify-content: center;
                align-items: center;
                background-color: #f8f8f8;
            }
            #preview-container img {
                max-width: 100%;
                max-height: 100%;
                width: auto;
                height: auto;
                object-fit: contain;
            }
            #game-container {
                width: 100%;
                height: 100%;
                display: none;
            }
        </style>
    </head>
    <body>
        <div id="game-selector">
            <button data-url="1.gb" 
                    data-preview="https://via.placeholder.com/800x400/0064ff/ffffff?text=Tetris+Preview"
                    onclick="switchGame(this.dataset.url, this.textContent.trim())"
                    onmouseover="updatePreview(this.dataset.preview)" 
                    class="active">Tetris</button>
            <button data-url="2.gb" 
                    data-preview="https://via.placeholder.com/800x400/ff69b4/ffffff?text=Super+Mario+Land+Preview"
                    onclick="switchGame(this.dataset.url, this.textContent.trim())"
                    onmouseover="updatePreview(this.dataset.preview)">Super Mario Land</button>
            <button data-url="3.gb" 
                    data-preview="https://via.placeholder.com/800x400/000080/ffffff?text=Asteroids+Preview"
                    onclick="switchGame(this.dataset.url, this.textContent.trim())"
                    onmouseover="updatePreview(this.dataset.preview)">Asteroids</button>
            <button data-url="4.gbc" 
                    data-preview="https://via.placeholder.com/800x400/8b0000/ffffff?text=GTA+2+Preview"
                    onclick="switchGame(this.dataset.url, this.textContent.trim())"
                    onmouseover="updatePreview(this.dataset.preview)">GTA 2</button>
        </div>
        <div id="content">
            <div id="preview-container">
                <img id="preview-img" src="https://via.placeholder.com/800x400/0064ff/ffffff?text=Tetris+Preview" alt="Game Preview">
            </div>
            <div id="game-container">
                <div id="game"></div>
            </div>
        </div>
        <script>
            // Function to update preview image on hover
            function updatePreview(src) {
                document.getElementById('preview-img').src = src;
            }

            // Function to switch games: saves selection and reloads page
            function switchGame(gameUrl, gameName) {
                localStorage.setItem('selectedGame', JSON.stringify({url: gameUrl, name: gameName}));
                location.reload();
            }
        </script>
        <script>
            // On page load, check for saved game and configure accordingly
            window.addEventListener('load', function() {
                const saved = localStorage.getItem('selectedGame');
                const previewContainer = document.getElementById('preview-container');
                const gameContainer = document.getElementById('game-container');
                const gameSelector = document.getElementById('game-selector');
                const buttons = document.querySelectorAll('#game-selector button');

                // Remove active from all buttons
                buttons.forEach(btn => btn.classList.remove('active'));

                if (saved) {
                    const data = JSON.parse(saved);
                    EJS_gameUrl = data.url;
                    EJS_gameName = data.name + '-USA[V1]';
                    previewContainer.style.display = 'none';
                    gameContainer.style.display = 'block';
                    gameSelector.style.display = 'none';  // Hide buttons once game starts

                    // Set active button based on URL (for future reference, though hidden)
                    const activeBtn = Array.from(buttons).find(btn => btn.dataset.url === EJS_gameUrl);
                    if (activeBtn) {
                        activeBtn.classList.add('active');
                    }

                    // Dynamically load the EmulatorJS loader only when a game is selected
                    const script = document.createElement('script');
                    script.src = 'https://cdn.emulatorjs.org/stable/data/loader.js';
                    document.head.appendChild(script);
                } else {
                    // Menu mode: show preview, hide game, set default active button
                    previewContainer.style.display = 'flex';
                    gameContainer.style.display = 'none';
                    gameSelector.style.display = 'flex';  // Ensure visible in menu
                    buttons[0].classList.add('active');  // Default to Tetris
                }
            });
        </script>
        <script>
            // Always set these emulator config vars (core, player, etc.)
            EJS_player = "#game";
            EJS_core = "gb";
            EJS_color = "#0064ff";
            EJS_pathtodata = "https://cdn.emulatorjs.org/stable/data/";
            // EJS_gameUrl and EJS_gameName are set conditionally in the load event above
        </script>
    </body>
</html>
